# SPH Channel Flow Simulation
Enhanced from Star SPH Code

## 1. 程式原理與功能

本程式基於 Smoothed Particle Hydrodynamics（SPH）方法。SPH 是一種無網格數值方法，將連續流體視為由大量粒子所組成，並利用平滑核函數來近似物理量的空間分布。

在 SPH 中，任意物理量 A(r) 可由鄰近粒子加權近似為：

A(r) ≈ Σ m_j · A_j / ρ_j · W(|r − r_j|, h)

其中 W 為平滑核函數，h 為平滑長度。

原始範例程式使用 SPH 來模擬自引力星體的密度平衡結構，其核心目標是在壓力梯度與外加勢能之間達到穩定分布。

本專案保留原始 SPH 的數學與數值架構，但重新設定研究目標，將模型轉為探討「受外力驅動之粒子系統行為」，並嘗試應用於工程流動情境的概念模擬。

目前程式可完成以下功能：
- 在矩形通道中初始化 SPH 粒子分布
- 施加水平方向體力 Gx，作為等效壓力梯度
- 施加垂直方向體力 g，模擬重力或斜面效應
- 透過全域阻尼項 nu 模擬黏性耗散
- 即時顯示粒子運動動畫
- 繪製整體平均流速 v_x 隨時間變化的圖形

## 2. 使用方式

本程式使用 Python 3 撰寫，需安裝以下套件：
- numpy
- matplotlib
- scipy

在終端機中執行：

python sph_enhanced_version.py

執行後畫面包含兩個部分：
- 上方顯示 SPH 粒子在矩形通道中的運動情形
- 下方顯示系統平均流速 v_x 隨時間的變化

## 3. 程式架構

程式主要結構如下，並與物理概念相對應：

- W(), gradW()  
  定義 SPH 平滑核函數及其梯度，是 SPH 方法的數學基礎。

- getPairwiseSeparations()  
  計算粒子間距離，用於後續密度與力的估算。

- getDensity()  
  透過核函數加權，估算粒子局部密度。

- getPressure()  
  保留原始星體模型中的狀態方程，作為未來延伸使用。

- getAcc()  
  計算粒子加速度，整合水平方向體力 Gx、垂直方向體力 g，以及黏性阻尼 nu。

- main()  
  負責初始化粒子、時間積分、邊界條件處理，以及結果視覺化。

## 4. 開發過程與遭遇的困難

本專題在開發過程中，最大的困難並非程式語法，而是理解原始 SPH 星體模型背後所描述的物理行為。

原始程式的設計目標是透過壓力與勢能的平衡，形成穩定的密度分布，並不以描述剪切流或邊界主導的速度場為目的。

當嘗試直接將該模型應用於管道流時，發現：
- 粒子容易形成整體移動的團塊
- 速度場難以產生明顯剪切結構
- 即使施加外力，系統仍不易進入理想穩態

這顯示問題並非單純的參數設定，而是模型原始假設與工程流動物理之間存在落差。

## 5. 程式修改與增強內容

相較於原始星體 SPH 範例，本專案進行了以下修改與嘗試：

- 將粒子初始分布由自由空間改為矩形通道
- 新增水平方向體力 Gx，作為等效壓力梯度
- 新增垂直方向體力 g，模擬重力影響
- 將輸出分析重點由密度分布改為平均流速隨時間變化
- 嘗試以工程流動角度重新詮釋 SPH 粒子行為

由於目前黏性模型仍以全域阻尼為主，邊界條件採用反彈牆，尚未完整實作剪切黏性與 no-slip 邊界條件，因此尚未重現典型 Poiseuille 流的拋物線速度剖面。

未來可改進方向包括：
- 引入與速度梯度相關的剪切黏性模型
- 改善邊界條件以符合 no-slip 假設
- 與解析解進行定量比較

## 6. 參考資料來源

- Philip Mocz, “Create Your Own Smoothed-Particle-Hydrodynamics Simulation (With Python)”
- 課堂講義（數值方法與流體力學相關內容）
- ChatGPT  
  協助理解原始 SPH 程式架構、分析物理適用性，並整理 README 說明內容。

原始 SPH 核函數與數值架構來自上述參考範例，其餘幾何設定、外力設計、分析方向與限制說明，皆為本人在理解原始程式後所進行之修改與整理。
