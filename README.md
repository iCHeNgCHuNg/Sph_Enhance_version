# SPH Channel Flow Simulation (Enhanced from Star SPH Code)

## 1. Project Purpose
本專題的目的是在活用課堂所學的數值方法與物理概念，並結合網路與 AI 資源，將既有的 Smoothed Particle Hydrodynamics (SPH) 範例程式進行改造，從原本用於模擬「自引力星體結構」的模型，延伸為可用來模擬「工程中常見之通道流（channel flow）」的數值實驗平台。

本程式嘗試以 SPH 粒子系統近似真實流體行為，並透過外加驅動力、黏性耗散與邊界條件，重現低雷諾數層流在矩形通道中的典型流動特徵。

---

## 2. Real-World System Analogy（SPH 與真實系統的對應）

本程式所模擬的 SPH 系統可對應多種真實物理與工程場景。雖然本模型並非完整求解 Navier–Stokes 方程式，但在低雷諾數、黏性主導的條件下，仍能捕捉多項關鍵流動特徵。

以下列出數個可對應的實際系統：

1. **平行平板間的層流（Plane Poiseuille Flow）**  
   在兩平行壁面之間，流體受到壓力梯度或等效體力驅動，形成中心速度最大、靠近壁面趨近於零的速度剖面。本程式中透過 `Gx` 作為等效壓力梯度，`nu` 作為黏性耗散，重現此類型流動。

2. **微流道（Microfluidic Channel）中的低雷諾數流動**  
   在微尺度通道中，慣性效應可忽略，流動主要由外力與黏性平衡所控制。SPH 粒子在此情境下可視為微小流體體積元素，適合用來示意微流道中的速度分布與邊界效應。

3. **受重力影響的開放通道或薄膜流（Gravity-Driven Flow）**  
   本程式引入 `g` 作為 y 方向的體力項，可對應到在重力場下流體沿斜面或通道流動的情形，例如薄膜流（film flow）或傾斜管道內流動。此時流動不僅受壓力梯度控制，也受到重力分量影響。

4. **工程中以體力近似壓力差的數值模型**  
   在許多數值模擬中，實際壓力差常以等效體力方式實現，以避免直接處理壓力邊界條件。本程式中同時存在 `Gx`（水平驅動）與 `g`（垂直體力），正是此類工程近似的示例。

透過上述對應，可以將本 SPH 模型視為一個「概念驗證型（proof-of-concept）」的流動模擬平台。

---

## 3. Program Functionality and Technical Principles

### (1) 程式功能
- 在矩形通道中初始化 SPH 粒子分布
- 施加 x 方向外力（`Gx`）模擬壓力梯度驅動流動
- 施加黏性／阻尼項（`nu`）以模擬能量耗散，使系統達到穩態
- 實作通道上下壁面邊界條件，使粒子在壁面附近速度受到限制
- 即時顯示粒子分布圖（上圖）與穩態速度剖面 `v_x(y)`（下圖）

### (2) 技術原理說明（非公式導向）
在通道流中，若只施加外力而無黏性耗散，粒子速度會隨時間無限增大，無法形成穩態。  
因此程式中加入黏性參數 `nu`，使外力輸入的動能能被耗散，最終形成「驅動力與耗散平衡」的穩態流動。

速度剖面的計算方式如下：
1. 將通道高度方向切分為多個區間（bins）
2. 依粒子 y 位置將其分類至對應區間
3. 對每個區間取粒子的平均 x 方向速度
4. 為避免初始過渡態影響，只對模擬後半段時間進行時間平均
5. 繪製平均速度 `v_x` 對 `y` 的關係，即為速度剖面

---

## 4. Adjustable Parameters and Their Physical Meaning

本程式設計了多個可調控參數，對應到真實系統中的物理操作或性質：

| 參數 | 程式中的角色 | 真實系統對應 |
|---|---|---|
| `Gx` | x 方向體力 | 壓力梯度、泵浦推力 |
| `g` | y 方向體力 | 重力場、斜面分量 |
| `nu` | 阻尼／黏性強度 | 流體黏度、能量耗散 |
| `h` | 平滑長度 | 空間解析度、平均尺度 |
| `Ly` | 通道高度 | 平板間距 |
| `Lx` | 通道長度 | 管道長度（週期邊界） |

其中：
- 增加 `Gx` 會提升整體流速，類似提高壓差
- 增加 `nu` 會使速度剖面趨於平緩，反映黏性增強
- 引入 `g` 可使流動產生垂直方向的偏移或分層效應，模擬重力影響下的流體行為

---

## 5. Program Structure

- `W(), gradW()`：SPH 核函數與其梯度
- `getPairwiseSeparations()`：計算粒子間相對距離
- `getDensity()`：以核函數加權估算粒子密度
- `getPressure()`：保留之狀態方程（供未來延伸）
- `getAcc()`：整合外力、黏性與邊界條件，計算加速度
- `main()`：初始化、時間積分、邊界處理、速度剖面計算與視覺化

---

## 6. Development Process and Major Difficulty Encountered

本專題在開發過程中遇到的主要困難，並非程式語法或函式實作問題，而是**如何在保留 SPH 架構的同時，重新賦予其工程流動的物理意義**。

原始 SPH 範例以星體結構為目標，其壓力項與勢能項設計用來維持三維對稱的密度分布。當直接將此模型套用於通道流時，會出現以下問題：
- 粒子傾向聚集為均勻團塊
- 即使施加外力，速度剖面仍接近均勻分布
- 重力項 `g` 與壓力項交互作用，反而掩蓋剪切效應

經分析後發現，這並非參數選擇錯誤，而是模型原始假設與目標物理系統不相容。

因此，本專案選擇：
- 將重點由「密度平衡」轉移至「速度場行為」
- 將 `Gx` 與 `g` 視為可控體力來源，而非真實壓力
- 以穩態速度剖面作為主要驗證依據，而非密度分布

這樣的取捨反映出 SPH 在不同物理問題中的適用範圍，也說明了為何在工程流動模擬中，邊界條件與黏性建模比單純壓力項更為關鍵。

---

